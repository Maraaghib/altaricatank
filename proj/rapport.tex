\documentclass[a4paper]{book}
\usepackage{fullpage}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[francais]{babel}

\usepackage{latexsym}
\usepackage{fancyhdr}
\usepackage{makeidx}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{moreverb}
\usepackage{listings}

\newcommand{\altarica}{{\sc AltaRica}}

\begin{document}

\title{Master 1, Conceptions Formelles\\
Projet du module \altarica\\
Synthèse (assistée) d'un contrôleur du niveau d'une cuve}

\date{}

\author{Nom1 \and Nom2 \and Nom3}

\maketitle

\chapter{Le sujet}
\input{tank}

\chapter{Le rapport}
\section{Rôle de la constante {\tt nbFailures} (2 points)}
La constante nbFailures est utilisée pour limiter le nombre de configurations atteignables. Elle correspond au nombre de valves qui peuvent être en panne en même temps.

$nbFailures >= (V[0].fail + V[1].fail + V[2].fail)$ correspond au fait que le nombre de valve qui tombent en panne doit toujours être inférieur à la valeur de la constante nbFailure, car cette ligne se trouve dans la section $assert$ du code.

\section{Résultats avec le contrôleur initial {\tt Ctrl}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (1 point)}
\lstinputlisting{Res/System0FCtrl.res}
\lstinputlisting{Res/System0FCtrl0F1I.res}
%\lstinputlisting{Res/System0FCtrl0F2I.res}
%\lstinputlisting{Res/System0FCtrl0F3I.res}
%\lstinputlisting{Res/System0FCtrl0F4I.res}
\paragraph{Interprétation des résultats : Contrôleur sans débit optimisé}
Le controlleur peut controller en évitant les blocages car $deadlock = 0$. Cependant, il ne peut pas assurer qu'on évitera les situations redoutés,
car on peut voir que $SR = 86$, ce qui indique qu'il y a 86 états dans lesquels le controlleurs se trouvera dans une situation redoutée.

\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}

Lorsqu'on optimise le débit aval, il est possible de contrôller en évitant tout blocages ou toute situation critique. En effet, la variable $SR = 0$.
On peut voir que dans ce contrôleur on a un total de 96 états ($any\_s$) et 858 transitions ($any\_t$). On peut aussi voir, via $CtrlCanControl$, qu'il y a 27 transisitions possibles différentes à partir de l'état initial du contrôleur.

\subsubsection{Avec 1 défaillance (1 point)}
\lstinputlisting{Res/System1FCtrl.res}
\lstinputlisting{Res/System1FCtrl1F1I.res}
%\lstinputlisting{Res/System1FCtrl1F2I.res}
%\lstinputlisting{Res/System1FCtrl1F3I.res}
%\lstinputlisting{Res/System1FCtrl1F4I.res}
\paragraph{Interprétation des résultats : contrôleur sans débit optimisé}
Avec 1 défaillance, on remarque qu'on peut pas contrôler en évitant les situations rédoutées car $SR$ est égale à l'union de $deadlock$ et de $NC$.
Donc dans notre cas, on a $SR$ qui partage les mêmes états avec $NC$.

Conclusion : le controleur peut contrôler car la variable CtrlCanControl est positive, mais on ne peut pas éviter de tomber dans des situations redoutées.

\paragraph{Interprétation des résultats : contrôleur avec débit optimisé}
Avec l'optimisation du débit 'aval', on remarque qu'on a moins d'états à gérer donc c'est plus facile pour le contrôleur de controler.

Cependant, on s'apperçoit dorénavant qu'on peut avoir des blocages à cause de la variable $deadlock = 96$, ce qui revient à dire qu'on ne peut pas contrôler sans éviter de tomber dans des situations redoutées car :

$NC$ et $deadlock$ partagent $69$ états et donc on risque d'augmenter les chances de tomber dans des états bloquants.

Conclusion : Malgré le fait qu'on ait optimisé le débit d'aval, on a constaté qu'on ne pourrait pas contrôler sans éviter de tomber dans $SR$ ou dans $deadlock$.
Aussi, on peut bien voir que $CCoupGagnant$ a beaucoup moins de transitions($2909$).

\subsubsection{Avec 2 défaillances (1 point)}
\lstinputlisting{Res/System2FCtrl.res}
\lstinputlisting{Res/System2FCtrl2F1I.res}
%\lstinputlisting{Res/System2FCtrl2F2I.res}
%\lstinputlisting{Res/System2FCtrl2F3I.res}
%\lstinputlisting{Res/System2FCtrl2F4I.res}
\paragraph{Interprétation des résultats : Contrôleur sans débit optimisé}
Ce controlleur peut aussi s'éxécuter en évitant les blocages car $deadlock = 0$. Cependant, il ne peut pas assurer qu'on évitera les situations redoutés.
Ici, $SR = 551$. On a donc beaucoup d'états dans lesquels on ne souhaite pas aller. Ceci est dû au fait qu'on peut avoir deux valves défaillantes.
Si une d'entre elle est celle de la sortie, on ne peut alors plus vider l'eau de la cuve et on atteint facilement les situations redoutées.

\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}

Lorsqu'on optimise le débit aval, on diminue le nombre de situations redoutées. Elle passent de 551 à 239. Cependant, on peut bloquer le système
car $deadlock = 239$. On peut noter que tous les niveaux critiques sont des situations où l'on se bloque, sinon on aurait $SR > deadlock$ (par l'absurde, si il existe un état dans $NC$ différent de tous ceux de $deadlock$ alors, $|NC \cup deadlock| > |deadlock|$)


\subsubsection{Avec 3 défaillances (1 point)}
\lstinputlisting{Res/System3FCtrl.res}
\lstinputlisting{Res/System3FCtrl3F1I.res}
%\lstinputlisting{Res/System3FCtrl3F2I.res}
%\lstinputlisting{Res/System3FCtrl3F3I.res}
%\lstinputlisting{Res/System3FCtrl3F4I.res}
\paragraph{Interprétation des résultats : Contrôleur sans débit optimisé}
Dans ce contrôleur, il n'est pas possible de se trouver dans un état bloquant ($deadlock = 0$). Il est néanmoins possible de se trouver dans un des nombreux états qui sont des niveaux critiques.
Avec $any\_s = 1832$ et $NC=617$, on peut voir que près d'un tier des états sont des situations critiques.

\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}
A l'inverse du contrôleur sans optimisation de débit, il n'est pas possible de se retrouver dans des situations ou le niveau de l'eau atteint un niveau critique ($NC = 0$), mais il est possible que le systeme se bloque dans un des 112 états qui sont dans $deadlock$.
Environ un état sur deux sont des états bloquants dans ce système. Il parait donc difficile de contrôler sans jamais se retouver dans un état appartenant à $deadlock$.

\subsection{Calcul des contrôleurs optimisés (2 points)}
% A COMPLETER en expliquant en quoi consiste l'optimisation mise en place.

% A COMPLETER en analysant les contrôleurs optimisés obtenus.
\subsubsection{Avec 0 défaillances}
\lstinputlisting{Res/System0FCtrl0F2I_Opt.res}
\paragraph{Interprétation des résultats : }
En effet, on constate qu'avec le contrôleur optimisé, on a beaucoup moins d'états à gérer par le contrôleur.
Avec $0$ défaillance, on n'a ni des états bloquants, ni des situations redoutées. Donc avec cette version, on peut bien contrôler en évitant toute situation redoutée ou blocante.

ce contrôleur a les caractéristiques suivantes :

$49$ états au total, et le contrôleur a 9 transitions à partir de son état initial.

\subsubsection{Avec 1 défaillances}
\lstinputlisting{Res/System1FCtrl1F3I_Opt.res}
\paragraph{Interprétation des résultats : }
Ce contrôleur ne peut pas contrôler en évitant toute situation redoutée ou blocante.
Par conséquent, le nombre total d'états a augmenté. De plus, $NC$ partage 36 états avec le $deadlock$, donc on a plus de possibilités de tomber dans des états blocants.

\subsubsection{Avec 2 défaillances}
\lstinputlisting{Res/System2FCtrl2F4I_Opt.res}
\paragraph{Interprétation des résultats :}
Pour ce qui concercne un contrôleur avec $2$ défaillance, on observe qu'on a la même situation(le contrôleur ne peut pas controller en évitant les blocages et les niveaux critiques) qu'on avait eu avec un $1$ défaillance.
Toutfois, si on compare les résultats avec la version non optimisée, on observe qu'on a mois d'états à gérer, en plus les débit d'aval de $out0$, $out1$ et $out2$ sont bien optimisés.

Conclusion : on ne peut pas contrôler sans éviter de tomber dans des états blocants ou dans des situations redoutées même avec l'optimisation.

\subsubsection{Avec 3 défaillances}
\lstinputlisting{Res/System3FCtrl3F3I_Opt.res}
\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}

\section{Rôle des composants {\tt ValveVirtual} et {\tt CtrlVV} (4 points)}
\paragraph{ValveVirtual : }
Le noeud ValveVirtual sert à simuler un Valve parfaite. Ainsi, lorsqu'une valve physique tombe en panne, la valve virtuelle prend le relais. Ainsi, le contrôleur peut toujours communiquer avec une valve et savoir quel est le niveau d'ouverture de celle ci.

\paragraph{CtrlVV}
Le noeud CtrlVV est un contrôleur similaire à Ctrl, à ceci près qu'il utilise des ValveVirtual à la place des variables de flux $rate$.
Le fait d'utiliser ces ValvesVirtual permet de repérer les disfonctionnement des valves physiques dans le système.

\section{Résultats avec le contrôleur initial {\tt CtrlVV}}
\subsection{Calcul d'un contrôleur}
\subsubsection{Avec 0 défaillance (1 point)}
\lstinputlisting{Res/System0FCtrlVV.res}
\lstinputlisting{Res/System0FCtrlVV0F1I.res}
%\lstinputlisting{Res/System0FCtrlVV0F2I.res}
%\lstinputlisting{Res/System0FCtrlVV0F3I.res}
%\lstinputlisting{Res/System0FCtrlVV0F4I.res}
\paragraph{Interprétation des résultats}

On peut observer que l'utilisation de valve virtuel n'impacte pas les débits ou le nombre de situations redoutées mais seulement le nombre de transitions possibles sur le cas de 0 défaillance.
Le fait qu'on ait ici moins de transitions signifie que le système est plus optimisé et plus rapide.
Dans le cas où les vannes ne sont pas défaillantes, on constate qu’il est possible d’éviter que le système se bloque, ainsi que les situations critiques.
On peut donc déduire qu’une des caractéristiques de ce contrôleur est qu’il est capable de gérer les pannes.

\subsubsection{Avec 1 défaillance (1 point)}
\lstinputlisting{Res/System1FCtrlVV.res}
\lstinputlisting{Res/System1FCtrlVV1F1I.res}
%\lstinputlisting{Res/System1FCtrlVV1F2I.res}
%\lstinputlisting{Res/System1FCtrlVV1F3I.res}
%\lstinputlisting{Res/System1FCtrlVV1F4I.res}
\paragraph{Interprétation des résultats}
\paragraph{Interprétation des résultats : Contrôleur sans débit optimisé}
Ce controlleur évite les bloquages, car on a la variable $deadlock = 0$. cependant, il n'est pas possible d'éviter les Niveaux Critiques, qui sont au nombre de 86.
On peut aussi voir que le contrôleur a 20 transitions partant de son état initial.

\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}
Dans cette version avec les débits optimisés, on ne peut plus se retrouver dans une situation où le niveau de l'eau est critique. Cependant, il est possible de tomber dans un blocages si on arrive dans l'un des 16 états de $deadlock$.
dans ce cas, le nombre d'états bloquant est très faible par rapport au nombre d'états total.

\subsubsection{Avec 2 défaillances (1 point)}
\lstinputlisting{Res/System2FCtrlVV.res}
\lstinputlisting{Res/System2FCtrlVV2F1I.res}
%\lstinputlisting{Res/System2FCtrlVV2F2I.res}
%\lstinputlisting{Res/System2FCtrlVV2F3I.res}
%\lstinputlisting{Res/System2FCtrlVV2F4I.res}
\paragraph{Interprétation des résultats}
\paragraph{Interprétation des résultats : Contrôleur sans débit optimisé}
Comme dans le cas précédent, il n'est pas possible de se retrouver bloquer car $deadlock=0$, mais il est possible d'arriver dans des états ou le niveau de l'eau est trop haut ou trop bas.
Ce controlleur a beaucoup d'états (presque 2400) et a sept fois plus de transitions que d'états.

A partir de l'état initial, le controlleur a le choix entre 26 transitions différentes.
\paragraph{Interprétation des résultats : Contrôleur avec débit optimisé}
Toujours comme dans le cas précédent, dans cette verision avec les débits optimisés, il est possible de tomber dans un $deadlock$ mais il n'est pas possible d'atteindre un niveau critique.

Ce controlleur a beaucoup moins d'état que la version sans optimisation des débits. En effet, il dispose de 274 états, soit près de 9 fois moins que l'autre.
Et il a plus de 21 fois moins de transition que la version non optimisée.


\subsubsection{Avec 3 défaillances (1 point)}
\lstinputlisting{Res/System3FCtrlVV.res}
\lstinputlisting{Res/System3FCtrlVV3F1I.res}
%\lstinputlisting{Res/System3FCtrlVV3F2I.res}
%\lstinputlisting{Res/System3FCtrlVV3F3I.res}
%\lstinputlisting{Res/System3FCtrlVV3F4I.res}
\paragraph{Interprétation des résultats}
% A COMPLETER

\subsection{Calcul des contrôleurs optimisés (2 points)}
% A COMPLETER en analysant les contrôleurs optimisés obtenus.

\section{Conclusion (2 points)}
% A COMPLETER

\end{document}
